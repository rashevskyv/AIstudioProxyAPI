<!DOCTYPE html>
<html lang="en" id="html-root">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Studio Proxy Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="webui.css">
</head>

<body>
    <div class="workspace-container">
        <!-- Chat Panel on the Left -->
        <div class="chat-panel">
            <h1>
                <span class="logo">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </span>
                AI Studio Proxy Chat
            </h1>

            <!-- Navigation -->
            <div class="main-nav">
                <button id="nav-chat" class="nav-button active">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="nav-icon">
                        <path
                            d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    Chat
                </button>
                <button id="nav-model-settings" class="nav-button">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="nav-icon">
                        <path
                            d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    Model Settings
                </button>
                <button id="nav-server-info" class="nav-button">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="nav-icon">
                        <path
                            d="M5 12H19M5 12C3.89543 12 3 11.1046 3 10V6C3 4.89543 3.89543 4 5 4H19C20.1046 4 21 4.89543 21 6V10C21 11.1046 20.1046 12 19 12M5 12C3.89543 12 3 12.8954 3 14V18C3 19.1046 3.89543 20 5 20H19C20.1046 20 21 19.1046 21 18V14C21 12.8954 20.1046 12 19 12M7 8H7.01M7 16H7.01"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    Server Status
                </button>
                <button id="themeToggleButton" title="Toggle theme">
                    <svg id="darkModeIcon" class="theme-icon" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 3a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1Z" fill="currentColor" />
                        <path d="M12 19a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1Z" fill="currentColor" />
                        <path d="M20 12a1 1 0 0 1 1 1 1 1 0 1 1-2 0 1 1 0 0 1 1-1Z" fill="currentColor" />
                        <path d="M4 12a1 1 0 0 1 1 1 1 1 0 1 1-2 0 1 1 0 0 1 1-1Z" fill="currentColor" />
                        <path d="M17.7 6.3a1 1 0 0 1 1.4 0 1 1 0 0 1 0 1.4l-.7.7a1 1 0 0 1-1.4-1.4l.7-.7Z"
                            fill="currentColor" />
                        <path d="M6.3 17.7a1 1 0 0 1 1.4 0 1 1 0 0 1 0 1.4l-.7.7a1 1 0 0 1-1.4-1.4l.7-.7Z"
                            fill="currentColor" />
                        <path d="M17.7 17.7a1 1 0 0 1 0 1.4l-.7.7a1 1 0 0 1-1.4-1.4l.7-.7a1 1 0 0 1 1.4 0Z"
                            fill="currentColor" />
                        <path d="M6.3 6.3a1 1 0 0 1 0 1.4l-.7.7A1 1 0 0 1 4.2 7l.7-.7a1 1 0 0 1 1.4 0Z"
                            fill="currentColor" />
                        <path d="M12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10Z" fill="currentColor" />
                    </svg>
                    <svg id="lightModeIcon" class="theme-icon" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M12 18.5c3.59 0 6.5-2.91 6.5-6.5S15.59 5.5 12 5.5 5.5 8.41 5.5 12s2.91 6.5 6.5 6.5Z"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" fill="currentColor" />
                    </svg>
                    
                </button>
            </div>

            <!-- View Container -->
            <div class="view-container">
                <!-- Chat View -->
                <div id="chat-view">
                    <div id="chatbox">
                        <!-- Chat messages will be appended here -->
                    </div>
                    <div id="input-area">
                        <div class="model-selector-container">
                            
                            <select id="modelSelector"></select>
                            <button id="refreshModelsButton" title="Refresh model list">Refresh</button>
                        </div>
                        <textarea id="userInput" placeholder="Enter a message... (Shift+Enter for newline)" rows="1"></textarea>
                        <button id="clearButton" class="action-button">Clear</button>
                        <button id="sendButton" class="action-button">Send</button>
                    </div>
                </div>

                <!-- Server Info View (hidden by default) -->
                <div id="server-info-view">
                    <div class="server-info-header">
                        <h3>Server Status & API Info</h3>
                        <button id="refreshServerInfoButton" class="action-button" title="Refresh status">Refresh</button>
                    </div>

                    <div id="api-info-area" class="info-card">
                        <h3>API Call Info</h3>
                        <div id="api-info-content">
                            <div class="loading-indicator">
                                <div class="loading-spinner"></div>
                                <span>Loading API info...</span>
                            </div>
                        </div>
                    </div>

                    <div id="health-status-area" class="info-card">
                        <h3>Service Health Status</h3>
                        <div id="health-status-display">
                            <div class="loading-indicator">
                                <div class="loading-spinner"></div>
                                <span>Loading health status...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Settings View (hidden by default) -->
                <div id="model-settings-view">
                    <div class="server-info-header">
                        <h3>Model Conversation Settings</h3>
                        <button id="resetModelSettingsButton" class="action-button" title="Reset to defaults">Reset</button>
                    </div>

                    <!-- APIAPI key management area -->
                    <div class="info-card">
                        <h3>API Key Management</h3>
                        <div class="settings-group">
                            <div class="api-key-status" id="apiKeyStatus">
                                <div class="loading-indicator">
                                    <div class="loading-spinner"></div>
                                    <span>Checking API key status...</span>
                                </div>
                            </div>

                            <div class="api-key-input-group">
                                <label for="newApiKey">Verify API Key:</label>
                                <div class="api-key-input-container">
                                    <input type="password" id="newApiKey" class="settings-input" placeholder="Enter the API key to verify...">
                                    <button id="toggleApiKeyVisibility" class="icon-button" title="Show / hide key">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="api-key-actions">
                                    <button id="testApiKeyButton" class="action-button">Verify Key</button>
                                </div>
                            </div>

                            <div class="api-key-list" id="apiKeyList">
                                <!-- Existing keys will be displayed here -->
                            </div>

                            <div class="settings-description">
                                <strong>Notes:</strong>
                                <ul>
                                    <li>Supports the standard OpenAI format: <code>Authorization: Bearer &lt;your_key&gt;</code></li>
                                    <li>Also supports custom format: <code>X-API-Key: &lt;your_key&gt;</code></li>
                                    <li>Keys are saved locally; no need to re-enter after refreshing the page.</li>
                                    <li>Use this panel to verify the key and check server key status.</li>
                                    <li>After verification you can view the server key list (masked).</li>
                                    <li>Chat will use the key you verified, not the server key.</li>
                                    <li>To add keys on the server, contact an admin or edit the server configuration directly.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>System Prompt</h3>
                        <div class="settings-group">
                            <label for="systemPrompt">System Prompt:</label>
                            <textarea id="systemPrompt" class="settings-textarea" rows="4"
                                placeholder="Enter a system prompt..."></textarea>
                            <div class="settings-description">
                                The system prompt is sent at the start of each conversation to define the model's behaviour and persona.
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>Generation Parameters</h3>
                        <div class="settings-group">
                            <label for="temperatureValue">Temperature:</label>
                            <div class="settings-slider-container">
                                <input type="range" id="temperatureSlider" class="settings-slider" min="0" max="2" step="0.01" value="1">
                                <input type="number" id="temperatureValue" class="settings-number" min="0" max="2" step="0.01" value="1">
                            </div>
                            <div class="settings-description">
                                Controls randomness. Higher values increase variety; lower values make replies more predictable.
                            </div>
                        </div>

                        <div class="settings-group">
                            <label for="maxOutputTokensValue">Max Output Tokens:</label>
                            <div class="settings-slider-container">
                                <input type="range" id="maxOutputTokensSlider" class="settings-slider" min="1" max="8192" step="1" value="2048">
                                <input type="number" id="maxOutputTokensValue" class="settings-number" min="1" max="8192" step="1" value="2048">
                            </div>
                            <div class="settings-description">
                                Limits the maximum number of tokens the model can produce.
                            </div>
                        </div>

                        <div class="settings-group">
                            <label for="topPValue">Top P:</label>
                            <div class="settings-slider-container">
                                <input type="range" id="topPSlider" class="settings-slider" min="0" max="1" step="0.01" value="0.95">
                                <input type="number" id="topPValue" class="settings-number" min="0" max="1" step="0.01" value="0.95">
                            </div>
                            <div class="settings-description">
                                Controls diversity. Lower values focus on high-probability tokens.
                            </div>
                        </div>

                        <div class="settings-group">
                            <label for="stopSequences">Stop Sequences:</label>
                            <input type="text" id="stopSequences" class="settings-input" placeholder="Separate multiple stop sequences with commas">
                            <div class="settings-description">
                                Generation stops when these sequences appear. Separate multiple entries with commas.
                                <br>Leave blank to use the server default.
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>Settings Save Status</h3>
                        <div id="settings-status" class="settings-status">
                            Settings apply automatically to chat and are stored locally.
                        </div>
                        <button id="saveModelSettingsButton" class="action-button full-width-button">Save Settings</button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Sidebar Panel on the Right (Now only for Logs) -->
        <div class="sidebar-panel collapsed" id="sidebarPanel">
            <div id="log-area">
                <div id="log-area-header">
                    <span>System Log Output</span>
                    <button id="clearLogButton" class="action-button icon-button" title="Clear log">Clear</button>
                </div>
                <div id="log-terminal-wrapper">
                    <div id="log-terminal">
                        <!-- Log entries will be appended here -->
                    </div>
                </div>
                <div id="log-status" class="log-status">[Log Status] Waiting for connection...</div>
            </div>
        </div>

        <button id="toggleSidebarButton" title="Expand sidebar">></button>

    </div>

    <script src="webui.js" defer></script>
</body>

</html>